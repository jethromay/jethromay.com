<div class="subscribe my-12">
    <div class="container mx-auto bg-gray-200 pt-6 pb-4 px-6 rounded">
        <p class="text-base mt-2">Subscribe to my newsletter for tech related tips, tricks and tutorials! No spam, unsubscribe anytime.</p>
        <form class="w-full mb-2">
            <label class="block hidden" for="email">Email Address</label>
            <input class="mb-3 p-2 mr-2 border-b-2 appearance-none rounded focus:bg-white focus:outline-none focus:border-blue-700" name="email" id="email" type="email" x-model="email" placeholder="Email Address">
            <button class="bg-blue-700 text-white p-2 rounded" type="submit">Subscribe</button>
            <div class="text-sm italic" id="message"></div>
        </form>
    </div>
</div>

<script>
    const newsletter = document.querySelector('form');
    const messageDiv = document.getElementById('message');

    if (newsletter) {
        newsletter.addEventListener('submit', e => {
            e.preventDefault();
            let email = document.getElementById('email').value;
            submitEmail(email);
        })
    }

    function submitEmail(email) {
        fetch('/.netlify/functions/subscribe', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: email
            })
        })
        .then(response => response.text())
        .then(body => {
            try {
                messageDiv.innerText = body;
                messageDiv.classList.add('text-green-400');
            } catch {
                messageDiv.innerText = body;
                messageDiv.classList.add('text-red-400');
            }
        });
    }
</script>

